{% extends 'core/base.html' %} 

{% block title %} De-Obfuscator {% endblock %} 

{% block content %}
  <div class="container mx-auto px-4 py-5">
    <h1 class="text-4xl font-bold text-center text-blue-700 mb-4">Welcome to the De-Obfuscator!</h1>
    <p class="text-lg text-gray-700 mb-4">
      Select your obfuscated file to start the de-obfuscation process.
    </p>

    <form class="center" method="post" enctype="multipart/form-data" action="{% url 'upload_obfuscated_file' %}">
      {% csrf_token %}

      <div class="file-upload flex flex-col items-center space-y-4">
        <!-- First Choose File input -->
        <div>
          <label for="image" class="block text-gray-700 text-sm font-bold mb-2">Choose Obfuscated File:</label>
          <input type="file" name="image" id="image" accept=".jpg, .jpeg, .png" class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline">
        </div>

        <!-- Single Upload button -->
        <button class="px-4 py-2 text-lg font-semibold bg-blue-500 text-white rounded-xl hover:bg-blue-700" type="submit">Upload</button>
      </div>
    </form>

    {% if deobfuscation_successful %}
      <div class="mt-4">
        <!-- Download button for de-obfuscated image -->
        <a href="{% url 'download_deobfuscated_image' %}" class="px-4 py-2 text-lg font-semibold bg-green-500 text-white rounded-xl hover:bg-green-700">Download De-Obfuscated Image</a>
        <!-- Download button for de-obfuscated executable -->
        <a href="{% url 'download_deobfuscated_executable' %}" class="px-4 py-2 text-lg font-semibold bg-green-500 text-white rounded-xl hover:bg-green-700 ml-4">Download De-Obfuscated Executable</a>
      </div>
    {% endif %}
    <script>
      document.getElementById('image').addEventListener('change', checkFiles);
  
      function checkFiles() {
        var file1 = document.getElementById('image').files.length;
  
        if (file1 > 0) {
          document.getElementById('uploadButton').disabled = false;
        } else {
          document.getElementById('uploadButton').disabled = true;
        }
      }
  
      // Call checkFiles at startup in case the browser remembered previous selections
      checkFiles();
    </script>
  </div>
{% endblock %}